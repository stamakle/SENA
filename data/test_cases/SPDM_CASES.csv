Name,Test_Case,Status,Type,Description,Precondition,Test Step #,Test Step Description,Test Step Expected Result
SPDM - Response While in the Link Disabled State,TC-128789,Active,Automated,,,1,Identify the PCIe SBDFs of the ports above the NVMe drives in the system.,The SBDFs are captured
,,,,,,2,"Disable the link to the NVMe drives by writing a '1' to bit 4 of the SBDF's Link Control Register.

You can use the LTSSM.py script/tool if you have the SDK installed.","The ""Data Link Layer Link Active bit (bit 13) of the SBDF's Link Status Register is now cleared."
,,,,,,3,"With the link now disabled, send the SPDM Discovery command sequence to each drive over SMBus:

Get_Version

Get_Capabilities

Negotiate_Algorithms

Get_Digests

Get_Certificate",All commands work successfully
,,,,,,4,"Enable the link to the NVMe drives by writing a '0' to bit 4 of the SBDF's Link Control Register.

You can use the LTSSM.py script/tool if you have the SDK installed.","The ""Data Link Layer Link Active bit (bit 13) of the SBDF's Link Status Register is now set.
"
SPDM - Response While in the Hot Reset State,TC-128791,Active,Automated,,,1,"Identify the PCIe SBDFs of the ports above the NVMe drives in the system.
","The SBDFs are captured
"
,,,,,,2,"Put the NVMe drives in hot reset by writing a '1' to bit 6 of the SBDF's Bridge Control Register.

You can use the LTSSM.py script/tool if you have the SDK installed.","The ""Data Link Layer Link Active bit (bit 13) of the SBDF's Link Status Register is now cleared.
"
,,,,,,3,"With the link now disabled, send the SPDM Discovery command sequence to each drive over SMBus:

Get_Version

Get_Capabilities

Negotiate_Algorithms

Get_Digests

Get_Certificate","All commands work successfully
"
,,,,,,4,"Take the NVMe drives out of hot reset by writing a '0' to bit 6 of the SBDF's Bridge Control Register.

You can use the LTSSM.py script/tool if you have the SDK installed.","The ""Data Link Layer Link Active bit (bit 13) of the SBDF's Link Status Register is now set.
"
SPDM - Response While in the PERST# State,TC-128792,Active,Automated,,,1,"Identify the PCIe SBDFs of the ports above the NVMe drives in the system.
","The SBDFs are captured
"
,,,,,,2,"Put the NVMe drives into PCIe reset by asserting the signal via a Quarch

You can use the QuarchControl.py script/tool if you have the SDK installed.","The ""Data Link Layer Link Active bit (bit 13) of the SBDF's Link Status Register is now cleared.
"
,,,,,,3,"With the link now in reset, send the SPDM Discovery command sequence to each drive over SMBus:

Get_Version

Get_Capabilities

Negotiate_Algorithms

Get_Digests

Get_Certificate","All commands work successfully
"
,,,,,,4,"Take the NVMe drives out of PCIe reset by de-asserting the signal via the Quarch

You can use the QuarchControl.py script/tool if you have the SDK installed.","The ""Data Link Layer Link Active bit (bit 13) of the SBDF's Link Status Register is now set.
"
SPDM - All Commands Complete within Specified Time,TC-128793,Active,Manual,,"SPDMCLI can be used throughout this test for sending SPDM commands

A PCIe analyzer is needed for timing the responses",1,Send a Get_Version command to all NVMe drives in the system,The Get_Version command completes successfully
,,,,,,2,Send a Get_Capabilities command to all NVMe drives in the system,The Get_Capabilities command completes successfully and the value for CTExponent is noted down
,,,,,,3,"Translate the CTExponent value to microseconds by using the following formula:

2 ^ (CTExponent)",The actual time for CTExponent is decoded
,,,,,,4,"Send the following SPDM commands:

Get_Version

Get_Capabilities

Negotiate_Algorithms

Get_Digests

Get_Certificates","Each SPDM command completes successfully, and within 100ms"
,,,,,,5,Send a Challenge SPDM command while timing its response,"The Challenge command completes in less time than the CTExponent time decoded in the step above
"
,,,,,,6,"Repeat steps 1-5, but this time use the opposite medium used originally. E.g., if you sed PCIe VDM first, the use SMBus, and vice versa.",The same results as in steps 1-5
SPDM - Long-Term Authentication Stress across D/C Power Cycles,TC-128795,Active,Manual,,"Make sure there are NVMe drives present in the system that support SPDM
",1,Boot into the OS and read from an iDRAC interface the SPDM status for all drives that support SPDM,"SPDM Capability = Capable

SPDM Version = 1.1.0.0 (or higher)

SPDM Digest and Certificate = Enabled

SPDM Challenge Auth Response = Enabled

SPDM Device Cert Status = Success

SPDM Device Challenge Status = Success"
,,,,,,2,"Perform a D/C power cycle of the server and go back to step 1
","The system boots back into the OS successfully
"
,,,,,,3,"Repeat steps 1-2 for 3 hours
","Same results as steps 1 and 2
"
